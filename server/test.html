<?xml version="1.0" encoding="UTF-8"?>
<page
        xmlns="http://cloudprint.cainiao.com/print"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://cloudprint.cainiao.com/print http://cloudprint-docs-resource.oss-cn-shanghai.aliyuncs.com/lpml_schema.xsd"
        xmlns:editor="http://cloudprint.cainiao.com/schema/editor"
        width="100" height="180"  splitable="true" >
	
		<%	
          var rplAddData = function(a, b) {
      try {
          var v = eval(b);
          if (v != undefined) {
              eval(a + ' = ' + b);
          }
      } catch (e) {}
  }

  rplAddData('_data.sender.name', '_data.addData.sender.name');
  rplAddData('_data.sender.phone', '_data.addData.sender.phone');
  rplAddData('_data.sender.mobile', '_data.addData.sender.mobile');
  rplAddData('_data.sender.address.province', '_data.addData.sender.address.province');
  rplAddData('_data.sender.address.city', '_data.addData.sender.address.city');
  rplAddData('_data.sender.address.district', '_data.addData.sender.address.district');
  rplAddData('_data.sender.address.town', '_data.addData.sender.address.town');
  rplAddData('_data.sender.address.detail', '_data.addData.sender.address.detail');

			var upQRCodeObj = JSON.parse('{}');
			
			if (_data.waybillCode) {
				upQRCodeObj.mn = _data.waybillCode;
			}
			var routingInfo = (_data || {}).routingInfo || {};
			if (routingInfo) {
				if (routingInfo.sortation && routingInfo.sortation.name) {
					upQRCodeObj.dtb = routingInfo.sortation.name;
				}
				
				if (routingInfo.routeCode) {
					var splitRouteCode = routingInfo.routeCode.split(' ');
            
					if (splitRouteCode.length >= 2) {
						upQRCodeObj.ssc = splitRouteCode[0];
						upQRCodeObj.tsc = splitRouteCode[1];
					}
				}
				
				if (routingInfo.consolidation && routingInfo.consolidation.code) {
					upQRCodeObj.pcn = routingInfo.consolidation.code;
				}
				
				if (routingInfo.receiveBranch && routingInfo.receiveBranch.code) {
					upQRCodeObj.rbc = routingInfo.receiveBranch.code;
				}
				
				if (routingInfo.origin && routingInfo.origin.code) {
					upQRCodeObj.sbc = routingInfo.origin.code;
				}
			}
			
			var upQRCodeData; 
			upQRCodeData = JSON.stringify(upQRCodeObj);
		%>

		<layout 
            
            
            id="element_layout_C2703061CD5215F7" width="100"  style="overflow:visible;zIndex:2;"><line
                    style="lineType:dotted;lineColor:#000;"
                    startX="1" 
                    startY="15.00" 
                    endX="98"
                    endY="15"
                    >
                </line>
                <line
                    style="lineType:dotted;lineColor:#000;"
                    startX="1" 
                    startY="30.00" 
                    endX="98"
                    endY="30"
                    >
                </line>
                <line
                    style="lineType:dotted;lineColor:#000;"
                    startX="1" 
                    startY="40.00" 
                    endX="98"
                    endY="40"
                    >
                </line>
                <line
                    style="lineType:dotted;lineColor:#000;"
                    startX="1" 
                    startY="55" 
                    endX="98"
                    endY="55"
                    >
                </line>
                <line
                    style="lineType:dotted;lineColor:#000;"
                    startX="1" 
                    startY="66" 
                    endX="98"
                    endY="66"
                    >
                </line>
                <line
                    style="lineType:dotted;lineColor:#000;"
                    startX="1" 
                    startY="86" 
                    endX="98"
                    endY="86"
                    >
                </line>
                <line
                    style="lineType:solid;lineColor:#000;"
                    startX="20.00" 
                    startY="86" 
                    endX="20"
                    endY="109.5"
                    editor:_deg_="90">
                </line>
                <line
                    style="lineType:dotted;lineColor:#000;"
                    startX="1" 
                    startY="120" 
                    endX="98"
                    endY="120"
                    >
                </line>
                <line
                    style="lineType:solid;lineColor:#000;"
                    startX="70" 
                    startY="120" 
                    endX="70"
                    endY="130"
                    editor:_deg_="90">
                </line>
                <line
                    style="lineType:dotted;lineColor:#000;"
                    startX="1" 
                    startY="130" 
                    endX="99"
                    endY="130"
                    >
                </line>
                <%
            var middleArea =''; 
	        var services = ((_data || {}).shippingOption ||{}||{}).services|| {};
	        var userLogisticsSelectVaule = (services["SVC-USER-LOGISTICS-SELECT"] || {})["USER_LOGISTICS_SELECT_VALUE"];
            var yuanzhunda =(services["SVC-YZD"]||false);
            var stringTime = (services["PROMISED-DELIVERY"]||{}).value||"";
            if(stringTime.length > 0){
              	 // 天猫直送
                 stringTime = stringTime.replace(new RegExp(/-/gm) ,"/");
                 var deliverTime = new Date(stringTime + ' 00:00:00');
                 var month = deliverTime.getMonth()+1;
                 var date = deliverTime.getDate();
                 middleArea += '<layout \ 
                            editor:_for_="1524118016248149" \          
                            id="1524118016249486" width="21.78" height="14.71" left="45.67" top="89.53"  style="zIndex:56;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/daily_ca50b9785da740f1b1e70b1b48dc97cb.png"  allowFailure="false" /> \
		                    </layout>';
                 middleArea += '<layout \
                            editor:_for_="1524117611086342" \            
                            id="1524117611086757" width="97" height="178" left="1" top="1"  style="zIndex:55;"><rect style="borderWidth:3;borderStyle:dotted;"></rect> \
                            </layout>';
                middleArea += '<layout \
                            editor:_for_="element_text_FCA7780A6223DE14" \         
                            id="element_layout_6972E61F8EBCFE7A" width="14" height="4.89" left="69" top="95"  style="overflow:visible;zIndex:29;"> \
                            <text  style="fontFamily:黑体;fontWeight:bold;valign:bottom;"> \
                                <![CDATA[签收栏：]]>\
                            </text></layout>';
                middleArea += '<layout  \
                            editor:_for_="1524129465137577" \      
                            id="1524129465138783" width="35" height="5" left="69" top="91"  style="zIndex:53;"> \
                            <text  style="fontFamily:黑体;fontWeight:bold;fontSize:9;"> \
                            <![CDATA[承诺送达:' + month +'月' + date + '日]]> \
                            </text></layout>';
            } else if (userLogisticsSelectVaule == "CE10001" || userLogisticsSelectVaule == "CE10002" ||userLogisticsSelectVaule == "CE10003" ||
            userLogisticsSelectVaule == "CE10004" || userLogisticsSelectVaule == "CE10005" || userLogisticsSelectVaule == "CE10006" 
            || userLogisticsSelectVaule == "CE10007") {
                // 消费者选择权
                middleArea += '<line style="lineType:solid;lineColor:#000;" startX="38" startY="89" endX="38" endY="108" editor:_deg_="90"></line> \
                            <layout  \
                                editor:_for_="1534234173580366" \
                                id="1534234173580305" width="36" height="12.61" left="60" top="89"  style="zIndex:49;"> \
                                <text   \
                                    style="fontFamily:SimHei;fontSize:7;lineHeight:4;valign:middle;"> \
                                    <![CDATA[您的签字代表您已验收此包裹，请仔细确认商品包装完好]]> \
                                </text> \
                            </layout> \
                            <layout  \
                                editor:_for_="1534234266510181" \
                                id="1534234266510148" width="25" height="5" left="60" top="104"  style="zIndex:50;"> \
                                <text   \
                                    style="fontFamily:SimHei;fontSize:7;"> \
                                    <![CDATA[签收栏：]]> \
                                </text> \
                            </layout>';
                var imageSrc ="";
              	if(userLogisticsSelectVaule == "CE10001"){
                    imageSrc = '"http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/400375ba71384ae5855b75dc5d3858fd.png"';
                }
                if(userLogisticsSelectVaule == "CE10002"){
                    imageSrc = '"http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/8d01399e824c4dd58153fe12933a98b0.png"';
                }
                if(userLogisticsSelectVaule == "CE10003"){
                    imageSrc = '"http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/4f7578524f9f41a5bc788ad5869b8f61.png"';
                }
                if(userLogisticsSelectVaule == "CE10004"){
                    imageSrc = '"http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/5cd5c3e5b41b49efb10139fb3669abbc.png"';
                }
                if(userLogisticsSelectVaule == "CE10005"){
                    imageSrc = '"http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/84bb11ba161d4a8cb3095f2fa36fa3c3.png"';
                }
                if(userLogisticsSelectVaule == "CE10006"){
                    imageSrc = '"http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/65749ee5a56e4a4cbe7fc43d020bf379.png"';
                }
                if(userLogisticsSelectVaule == "CE10007"){
                    imageSrc = '"http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/81639d37b721434099bbddf1cbecd81b.png"';
                }
                middleArea += '<layout editor:_for_="1534236257969372" \
                            id="153423625796915" width="12" height="12" left="47.17" top="93.34"  style="zIndex:50;"><image src=';
                middleArea +=imageSrc;
                middleArea +=' allowFailure="false" /> \
                            </layout>';
            }else if(yuanzhunda){
                middleArea +='<layout \
                            editor:_for_="1562315647065266" \      
                            id="1562315647066462" width="52.66" height="16.67" left="46.03" top="86.50"  style="zIndex:56;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/6ee78cb9e49c43119188e792d747f267.png"  allowFailure="false" /> \
		                    </layout>';
                middleArea +='<layout \
                            editor:_for_="element_image_BE1599FAB77EFC96" \       
                            id="element_layout_592C884AA1726B53" width="5" height="4" left="90.34" top="104"  style="overflow:visible;zIndex:15;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474191623743.png"  allowFailure="false" /> \
		                    </layout>'

                middleArea +='<layout \
                            editor:_for_="element_text_FCA7780A6223DE14" \
                            id="element_layout_6972E61F8EBCFE7A" width="9.6" height="3.89" left="80.53" top="104.3"  style="overflow:visible;zIndex:31;"> \
                            <text  style="fontFamily:黑体;fontSize:7;align:right;valign:bottom;"> \
                            <![CDATA[签收栏]]> \
                            </text></layout>';               
            }else{
              	// 橙诺达1.0
                middleArea += '<layout \ 
                            editor:_for_="element_text_E9326CD5676BB87A" \   
                            id="element_layout_9CA2BF2FDD4CCE85" width="50.53" height="14.95" left="47" top="89.35"  style="overflow:visible;zIndex:26;"> \
                            <text style="fontFamily:黑体;fontSize:7;lineHeight:3;valign:middle;"> \
                                <![CDATA[快件送达收件人地址，经收件人或收件人（寄件人）允许的代收人签字，视为送达。您的签字代表您已经签收此包裹，并已确认商品信息无误、包装完好、没有划痕、破损等表面质量问题。]]> \
                            </text></layout><layout \
                            editor:_for_="element_image_BE1599FAB77EFC96" \       
                            id="element_layout_592C884AA1726B53" width="5" height="4" left="90.34" top="104"  style="overflow:visible;zIndex:15;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474191623743.png"  allowFailure="false" /> \
		                    </layout>';
                middleArea +='<layout \
                            editor:_for_="element_text_FCA7780A6223DE14" \
                            id="element_layout_6972E61F8EBCFE7A" width="9.6" height="3.89" left="80.53" top="104.3"  style="overflow:visible;zIndex:31;"> \
                            <text  style="fontFamily:黑体;fontSize:7;align:right;valign:bottom;"> \
                            <![CDATA[签收栏]]> \
                            </text></layout>';
                if(_data.shippingOption.services &&_data.shippingOption.services["SVC-PROMISE-DELIVERY"]){
                    var chengnuoda = _data.shippingOption.services["SVC-PROMISE-DELIVERY"]["promise-type"]||"";
                    if(chengnuoda == 'SAMEDAY_DELIVERY' || chengnuoda == 'NEXTDAY_DELIVERY' || chengnuoda == 'THREEDAYS_DELIVERY' || 
                        chengnuoda== 'FOURDAYS_DELIVERY' ||  chengnuoda== 'FIVEDAYS_DELIVERY' ||  chengnuoda== 'SIXDAYS_DELIVERY' || 
                        chengnuoda== 'SEVENDAYS_DELIVERY'){
                        middleArea += '<layout \
                        editor:_for_="element_text_80D86B0F290171E7" \
                        id="element_layout_DB205D5E9C8E3281" width="58.53" height="14.95" left="45" top="89.35"  style="overflow:visible;zIndex:48;"> \
                        <text \  
                        style="fontFamily:黑体;fontSize:40;align:center;valign:middle;alpha:0.7;"> \
                            <![CDATA[橙诺达]]> \
                        </text></layout> ';
                    }
                }
            }
          var isPrivacy = true;
          var recipientMobile = ((_data ||{}).recipient || {}).mobile || "";
          var recipientPhone = ((_data ||{}).recipient || {}).phone || "";
          
           var secretWaybillType = ((_data||{}).secretWaybillType ||"");
           if(secretWaybillType == "recipientSecret" && recipientPhone.indexOf("-")!= -1){
              isPrivacy =false;
              recipientPhone = recipientPhone.replace("-","转");
              _data.recipient.phone = recipientPhone;
            }
          if (isPrivacy) {
            if (recipientMobile.length >= 11) {
                recipientMobile = recipientMobile.slice(0,recipientMobile.length - 8) + "****" + recipientMobile.slice(-4);
            }  
            if (recipientPhone.length >= 8) {
                recipientPhone = recipientPhone.slice(0,recipientPhone.length - 8) + "****" + recipientPhone.slice(-4);
            } 
          }
          				var sortation_name = (((_data || {}).routingInfo ||{}||{}).sortation||{}||{}).name||"";
				var route_code = ((_data || {}).routingInfo ||{}||{}).routeCode||"";
                var blockCode = ((_data || {}).routingInfo ||{}||{}).blockCode||"";
                var blockSubCode = ((_data || {}).routingInfo ||{}||{}).blockSubCode||"";
          		var datoubi;
          		if(route_code == ""){
                  datoubi=sortation_name;
                }else{
                  datoubi=route_code;
                }
                          
                var endCode = ((_data || {}).routingInfo ||{}||{}).endCode||"";
                var endCodeType = ((_data || {}).routingInfo ||{}||{}).endCodeType||"";
                var stageCode = ((_data || {}).routingInfo ||{}||{}).stageCode||"";
                if( endCodeType.length >0 ){
                  var preBlockCode =blockCode;
                    if(endCodeType == 1){
                        blockCode="C驿";
                    }else if(endCodeType == "2"){
                        blockCode ="C柜";
                    }else if(endCodeType == "3" ){
                        blockCode = "S驿";
                    }else if(endCodeType == "4"){
                        blockCode ="S柜";
                    }
                    blockCode +=endCode;
                    blockSubCode = preBlockCode;
                }else if(stageCode.length >0){
                    blockCode = stageCode;
                    blockSubCode ="";
                } 
        %>
<%=middleArea%>
<layout 
            editor:_for_="element_text_D0362864BFED5BCB"
            
            id="element_layout_A2D8F71EC01AAA8C" width="87.5" height="14.5" left="11.5" top="40.35"  style="overflow:visible;zIndex:38;">
            <text editor:_printName_="收件人姓名          座机         手机                 -收件人地址" 
                style="fontFamily:SimHei;fontWeight:bold;fontSize:auto;">
                <![CDATA[<%=_data.recipient.name%>   <%=_data.recipient.phone%>   <%=_data.recipient.mobile%>
<%=_data.recipient.address.province%><%=_data.recipient.address.city %><%=_data.recipient.address.district%><%=_data.recipient.address.town%><%=_data.recipient.address.detail%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_text_39EAD4AA7158C60E"
            
            id="element_layout_2F4B3DAFC5CD6CDA" width="87.5" height="4.15" left="10.5" top="55.35"  style="overflow:visible;zIndex:40;">
            <text editor:_printName_="寄件人姓名          座机         手机" 
                style="fontFamily:simhei;">
                <![CDATA[<%=_data.sender.name%>   <%=_data.sender.phone%>   <%=_data.sender.mobile%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_text_0C29FB167353E125"
            
            id="element_layout_BDDA5CD4BF325616" width="56.9" height="4" left="11" top="120.35"  style="overflow:visible;zIndex:45;">
            <text editor:_printName_="收件人姓名        座机        手机" 
                style="fontFamily:simhei;fontSize:7;">
                <![CDATA[<%=_data.recipient.name%>  <%=recipientPhone%>  <%=recipientMobile%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_text_5EEB4684D5099746"
            
            id="element_layout_BCCEE46036FB5554" width="78" height="13" left="1" top="15.5"  style="overflow:visible;zIndex:22;">
            <text  
                style="fontFamily:simhei;fontWeight:bold;fontSize:auto;align:center;valign:middle;">
                <![CDATA[<%=datoubi%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_text_1B9D4C420D20F87A"
            
            id="element_layout_8A1394C5E25FAF84" width="50" height="9" left="11.5" top="30.35"  style="overflow:visible;zIndex:23;">
            <text editor:_printName_="集包地" 
                style="fontFamily:simhei;fontWeight:bold;fontSize:auto;valign:middle;">
                <![CDATA[<%=_data.routingInfo.consolidation.name%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_text_5D213708D1B2017A"
            
            id="element_layout_69EECF1EB66409AD" width="87.12" height="6.43" left="10.5" top="59.57"  style="overflow:visible;zIndex:24;">
            <text editor:_printName_="寄件人地址" 
                style="fontFamily:simhei;lineHeight:4;">
                <![CDATA[<%=_data.sender.address.province%><%=_data.sender.address.city %><%=_data.sender.address.district%><%=_data.sender.address.town%><%=_data.sender.address.detail%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_text_4502C5900F885A80"
            
            id="element_layout_F941B52EC5172936" width="12.78" height="3.87" left="1" top="103.3"  style="overflow:visible;zIndex:27;">
            <text  
                style="fontFamily:simhei;fontSize:7;align:right;valign:bottom;">
                <![CDATA[打印时间]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_brcode_A48601852409D928"
            
            id="element_layout_92B7062628BED605" width="80.11" height="19.46" left="7.79" top="66.54"  style="overflow:visible;zIndex:42;"><barcode type="code128" style="hideText:false;rotation:0" value="<%=_data.waybillCode%>" ratioMode="keepRatio" />
		</layout><layout 
            editor:_for_="element_text_B12AA29A2A78E991"
            
            id="element_layout_2EB6125289467429" width="18.3" height="4.5" left="1.5" top="92.5"  style="overflow:visible;zIndex:31;">
            <text editor:_printName_="时间" 
                style="fontFamily:simhei;fontSize:11;">
                <![CDATA[<%=_context.formatStartTime('HH:mm:ss')%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_text_48F9C47B8972EA41"
            
            id="element_layout_3ADDAF57FC4C5E3C" width="17" height="6" left="1.5" top="97"  style="overflow:visible;zIndex:33;"><%
           var docSeq = _context.documentNumber();
        if (typeof _context.documentCount == "function") {
          docSeq = docSeq + "/" + _context.documentCount();
        }
          %>

            <text editor:_printName_="序号" 
                style="fontFamily:simhei;fontSize:13;">
                <![CDATA[<%= docSeq %>]]>
            </text>
        
		</layout><layout 
            editor:_for_="element_brcode_7ACBE9FAE6FE7B63"
            
            id="element_layout_956645557D3AAE36" width="35" height="8.12" left="63" top="31.35"  style="overflow:visible;zIndex:34;"><barcode type="code128" style="hideText:true;rotation:0" value="<%=_data.routingInfo.consolidation.code%>" ratioMode="keepRatio" />
		</layout><layout 
            editor:_for_="element_brcode_CEDB3635C33FF1B2"
            
            id="element_layout_168920CEB02D8246" width="67.72" height="10" left="31.2" top="110"  style="overflow:visible;zIndex:19;"><barcode type="code128" style="hideText:false;rotation:0" value="<%=_data.waybillCode%>" ratioMode="keepRatio" />
		</layout><layout 
            editor:_for_="element_text_AF8FF0813794EB22"
            
            id="element_layout_4FA8E0FB8CD621DD" width="57.13" height="5.48" left="10.76" top="124.52"  style="overflow:visible;zIndex:35;">
            <text editor:_printName_="地址" 
                style="fontFamily:simhei;fontSize:7;lineHeight:3;valign:middle;">
                <![CDATA[<%=_data.recipient.address.province%><%=_data.recipient.address.city %><%=_data.recipient.address.district%><%=_data.recipient.address.town%><%=_data.recipient.address.detail%>]]>
            </text>
        
		</layout><% if(_config.needTopLogo === true){%>
<layout 
            editor:_for_="element_image_756DC119AC15A3AA"
            
            id="element_layout_E13728DDC825CA39" width="30" height="14" left="2.2" top="0.5899999999999999"  style="overflow:visible;zIndex:21;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474252117783.jpg"  allowFailure="false" />
		</layout><%}%>
<% if(_config.needBottomLogo === true){%>
<layout 
            editor:_for_="element_image_4299CD5F8EFB2542"
            
            id="element_layout_6D516E89CB68D1AB" width="26" height="8.5" left="2" top="111"  style="overflow:visible;zIndex:20;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474252125181.jpg"  allowFailure="false" />
		</layout><%}%>
<layout 
            editor:_for_="element_image_702A1E7CCD39CCEC"
            
            id="element_layout_BCDD735DA98014D5" width="9" height="9" left="2" top="30.5"  style="overflow:visible;zIndex:18;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474191217698.png"  allowFailure="false" />
		</layout><layout 
            editor:_for_="element_image_5DEEBD4D81722C69"
            
            id="element_layout_60E64A5F027DD9D3" width="9" height="10" left="2" top="42.57"  style="overflow:visible;zIndex:17;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474191080248.png"  allowFailure="false" />
		</layout><layout 
            editor:_for_="element_image_168D6EAC905903E7"
            
            id="element_layout_9B51040B49260B8C" width="7" height="7" left="2" top="57.35"  style="overflow:visible;zIndex:16;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474191355903.png"  allowFailure="false" />
		</layout><layout 
            editor:_for_="element_image_E1D398D19CE8A2FF"
            
            id="element_layout_E6869E33FA3367C2" width="6.5" height="7" left="2" top="121.47"  style="overflow:visible;zIndex:15;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474191080248.png"  allowFailure="false" />
		</layout><layout 
            editor:_for_="element_image_6926397889F65589"
            
            id="element_layout_D88365A374B21DDE" width="4" height="4" left="15.41" top="103"  style="overflow:visible;zIndex:13;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474191519187.png"  allowFailure="false" />
		</layout><layout 
            editor:_for_="element_text_B3A52D78379DB84B"
            
            id="element_layout_FBE3EDA35582F047" width="17.5" height="4.5" left="1.5" top="88.35"  style="overflow:visible;zIndex:30;">
            <text editor:_printName_="日期" 
                style="fontFamily:simhei;">
                <![CDATA[<%=_context.formatStartTime('yyyy/MM/dd')%>]]>
            </text>
        
		</layout><layout 
            
            ref="CUSTOM_AREA"
            id="element_layout_CBD1AEE6FA74C93E" width="100" height="40" left="1" top="130"  style="overflow:hidden;zIndex:37;">
		</layout><layout 
            editor:_for_="element_text_9F41AE2F911CB4E3"
            
            id="element_layout_F541A2BF47B0C8C8" width="9.6" height="4" left="88" top="156"  style="overflow:visible;zIndex:37;">
            <text  
                style="fontFamily:simhei;fontSize:7;">
                <![CDATA[已验视]]>
            </text>
        
		</layout><line
                    style="lineType:solid;lineColor:#000;"
                    startX="46" 
                    startY="86" 
                    endX="46"
                    endY="109.5"
                    editor:_deg_="90">
                </line>
                <layout 
            editor:_for_="element_qrcode_1472627448349"
            
            id="element_layout_A81E2E88D84F437E" width="23" height="23" left="21.7" top="87"  style="overflow:visible;zIndex:46;"><barcode type="qrcode" ratioMode="keepRatio"       ><![CDATA[]]></barcode>
		</layout><%
          var secondRouteCode;
          
          if (route_code) {
            var fixRouteCode = route_code.split(/-| /);
            
            if (fixRouteCode.length >= 2) {
          	secondRouteCode=fixRouteCode[1];
            }
          }
          
          if (secondRouteCode){
          %>
<layout 
            editor:_for_="element_text_491F1481F4B3498D"
            
            id="element_layout_B026B589B5FDC7AE" width="80" height="22" left="12" top="42"  style="overflow:visible;zIndex:50;">
            <text editor:_printName_="二段码水印" 
                style="fontFamily:SimHei;fontWeight:bold;fontSize:64;letterSpacing:5;lineHeight:0;align:center;valign:middle;alpha:0.65;">
                <![CDATA[<%=secondRouteCode%>]]>
            </text>
        
		</layout><%}%>
<%			
			String.format = function(src) {
				if (arguments.length == 0) return null;
				var args = Array.prototype.slice.call(arguments, 1);
				return src.replace(/\{(\d+)\}/g, function(m, i){return args[i];});
			};
			
			var Service = function(key, hasValue, format, textFormat, offset) {
				this.key = key;
				this.hasValue = hasValue;
				this.format = format;
				this.textFormat = textFormat
				this.offset = offset;
			}
			
			var Services = function () {
				this.init();
			};
			
			Services.prototype.init = function () {
				// 标准快递
				this.standserviceFormat = '<layout width="14" height="14" left="51" top="1"  style="overflow:visible;zIndex:31;borderWidth:0 0 0 1">\
						<text style="fontFamily:simhei;fontWeight:bold;fontSize:15;align:center;valign:bottom">\
							<![CDATA[标准快递]]>\
						</text>\
					</layout>';
				// 代收货款
				this.codServiceTextFormat = '代收货款：{0}';
				this.codServiceFormat = '<layout width="15" height="14" left="{0}" top="1"  style="overflow:visible;zIndex:31;borderWidth:0 0 0 1">\
						<layout width="15" height="9" left="0" top="0"  style="overflow:visible;zIndex:31;">\
							<text style="fontFamily:simhei;fontWeight:bold;fontSize:19;{1}align:center;valign:bottom">\
								<![CDATA[COD]]>\
							</text>\
						</layout>\
						<layout width="15" height="5" left="0" top="9"  style="overflow:visible;zIndex:31;">\
							<text style="fontFamily:simhei;fontWeight:bold;fontSize:10;{1};align:center;valign:top">\
								<![CDATA[代收货款]]>\
							</text>\
						</layout>\
					</layout>';
				// 服务相关文本
				this.serviceTextFormat = '<layout width="26" height="14" left="{0}" top="1"  style="overflow:visible;zIndex:31;borderWidth:0 0 0 1">\
						<layout width="25" height="14" left="1" top="0">\
							<text style="fontFamily:simhei;fontWeight:bold;fontSize:{1};align:left;valign:middle">\
								<![CDATA[{2}]]>\
							</text>\
						</layout>\
					</layout>';
				this.servicePickupFormat = '<layout width="13" height="14" left="{0}" top="1"  style="overflow:visible;zIndex:31;borderWidth:0 0 0 1">\
						<layout width="13" height="8" left="0" top="0"  style="overflow:visible;zIndex:31;">\
							<text style="fontFamily:simhei;fontWeight:bold;fontSize:11;align:center;valign:middle;">\
								<![CDATA[{1}]]>\
							</text>\
						</layout>\
						<layout width="13" height="6" left="0" top="8"  style="overflow:visible;zIndex:31;">\
							<text style="fontFamily:simhei;fontWeight:bold;fontSize:10;align:center;valign:top">\
								<![CDATA[揽件码]]>\
							</text>\
						</layout>\
					</layout>';
// 海外标
				this.overseaServiceFormat = '<layout width="15" height="14" left="{0}" top="1"  style="overflow:visible;zIndex:31;borderWidth:0 0 0 1">\
						<layout width="15" height="14" left="0" top="0"  style="overflow:visible;zIndex:31;">\
							<text style="fontFamily:simhei;fontWeight:bold;fontSize:16;{1}align:center;valign:middle;">\
								<![CDATA[海外]]>\
							</text>\
						</layout>\
					</layout>';
				this.codService = new Service("SVC-COD", true, this.codServiceFormat, this.codServiceTextFormat, 15);
				this.overseaService = new Service("SVC-INTERNATIONAL", false, this.overseaServiceFormat, "", 15);
				this.serviceArray = new Array(this.overseaService, this.codService);
				this.content = "";
				this.parse();
			}
			
			Services.prototype.parse = function () {
				var services = ((_data || {}).shippingOption ||{}||{}).services||"";
				if (services) {
					var maxLeft = 65;
					var serviceTextFormatValue = "";
					var textLineCount = 0;
					var serviceCount = 0;
					var textExtend = "backgroundColor:#000;fontColor:#fff;";
					for(var index = 0, service;service=this.serviceArray[index++];) {
						if (services[service.key] && (!service.hasValue || services[service.key]["value"])) {
							maxLeft -= service.offset;
							service.format = String.format(service.format, maxLeft, textExtend);
							textExtend = "";
							// 设置显示数据
							if (service.hasValue) {
								var serviceValue = services[service.key]["value"];
								if (serviceTextFormatValue.length > 0) {
									serviceTextFormatValue += "\r\n";
								}
								textLineCount++;
								service.textFormat = String.format(service.textFormat, serviceValue);
								serviceTextFormatValue += service.textFormat;
							}
							// 添加服务区域内容
							this.content += service.format;
							serviceCount++;
						}
					}
					
					if (0 == serviceCount) {
                      	maxLeft -= 14;
						this.content=this.standserviceFormat;
					} else {
						if (serviceTextFormatValue.length > 0) {
							var fontSizeArray = new Array(13, 8, 8);
							maxLeft -= 26;
							this.serviceTextFormat = String.format(this.serviceTextFormat, 
								maxLeft,// 服务文本区域大小
								fontSizeArray[textLineCount - 1], 
								serviceTextFormatValue);
							this.content += this.serviceTextFormat;
						}
					}
                  // 揽件码
						if (_data.pickupCode) {
							maxLeft -= 13;
							this.servicePickupFormat = String.format(this.servicePickupFormat, maxLeft, _data.pickupCode);
							this.content += this.servicePickupFormat;
						}
				}
			}
			var services = new Services();
		%>
<layout 
            
            
            id="1516954619218360" width="65" height="15" left="34" top="0"  style="overflow:visible;zIndex:100;"><%=services.content%>

		</layout><layout 
            editor:_for_="1555663062681567"
            
            id="1555663062681219" width="12" height="14" left="81.07" top="16.8"  style="zIndex:49;">
            <text editor:_printName_="蝶园北区" 
                style="fontFamily:SimHei;fontSize:16;">
                <![CDATA[<%=blockCode%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="1555663134007883"
            
            id="1555663134008512" width="7" height="8" left="92.65" top="21.14"  style="zIndex:53;">
            <text editor:_printName_="6幢3楼" 
                style="fontFamily:SimHei;">
                <![CDATA[<%=blockSubCode%>]]>
            </text>
        
		</layout><line
                    style="lineType:dashed;lineColor:#000;"
                    startX="80" 
                    startY="15" 
                    endX="80"
                    endY="30"
                    editor:_deg_="90">
                </line>
                <layout 
            editor:_for_="element_image_B520FBC513E2D3A4"
            
            id="element_layout_C19C8F7A5A859B82" width="5.5" height="5.5" left="71.32" top="121.58"  style="overflow:visible;zIndex:14;"><image src="http://cdn-cloudprint.cainiao.com/waybill-print/cloudprint-imgs/1474191355903.png"  allowFailure="false" />
		</layout><line
                    style="lineType:dashed;lineColor:#000;"
                    startX="80" 
                    startY="15" 
                    endX="80"
                    endY="30"
                    editor:_deg_="90">
                </line>
                <%
          var senderShortName = _data.sender.name.length > 7 ? _data.sender.name.substring(0,6)+"…" : _data.sender.name;
          var senderPhone = ((_data ||{}).sender || {}).mobile || "";
          if (!senderPhone) {
            senderPhone = ((_data ||{}).sender || {}).phone || "";
          }
          var senderShortAddr = _data.sender.address.province + " " + _data.sender.address.city;
          senderShortAddr = senderShortAddr.replace(/省|市|县|区/g,"");
          %>
<layout 
            editor:_for_="element_text_A12AE8F34C37818E"
            
            id="element_layout_61E86C4D84D36270" width="20" height="3" left="79" top="120.56"  style="overflow:visible;zIndex:32;">
            <text editor:_printName_="寄件人姓名" 
                style="fontFamily:黑体;fontSize:7;">
                <![CDATA[<%=senderShortName%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="1556099716510977"
            
            id="1556099716510984" width="20" height="3" left="79" top="123.56"  style="zIndex:48;">
            <text editor:_printName_="手机" 
                style="fontFamily:黑体;fontSize:7;">
                <![CDATA[<%=senderPhone%>]]>
            </text>
        
		</layout><layout 
            editor:_for_="1556099736189841"
            
            id="1556099736189530" width="20" height="3" left="79" top="126.56"  style="zIndex:54;">
            <text editor:_printName_="地址" 
                style="fontFamily:黑体;fontSize:7;">
                <![CDATA[<%=senderShortAddr%>]]>
            </text>
        
		</layout>
    </layout>
    <layout id="1567601479827" editor:_for_="1567601479827" height="8" width="30" left="0" top="100" orientation="horizontal" style="overflow:visible;zIndex:1"><text editor:_printName_="<%=_data.name%>" style="orientation:horizontal;fontFamily:宋体;fontSize:8;fontWeight:normal;align:left;valign:left;"><![CDATA[打发士大夫]]></text></layout>
		<footer height="10" ><%if(_data.adsInfo && _data.adsInfo.bannerUrl && _data.adsInfo.bannerUrl != ''){%>
<layout 
            editor:_for_="1558060158228235"
            
            id="1558060158228363" width="96" height="9" left="2" top="0"  style="zIndex:1;"><image src="<%=_data.adsInfo.bannerUrl%>"  allowFailure="false" />
		</layout><%}%>
<layout 
            editor:_for_="1558060180390942"
            
            id="1558060180394198" width="15" height="15" left="83" top="-7"  style="zIndex:2;"><barcode type="qrcode" ratioMode="keepRatio"       ><![CDATA[<%=_data.adsInfo.trackUrl%>]]></barcode>
    </layout>
    
		</footer>
</page>
